// Quand le html est charg√© alors on lance la fonction
document.addEventListener("DOMContentLoaded", launchPage);

function launchPage() {

    //! JOUR DE LA SEMAINE
    // R√©cuperer le jour de la semaine, puis changer la valeur du H1 en fonction du jour
    let date = new Date();
    let day = date.getDay();

    let jour = document.getElementById("jour");
    let dayName = getDay(day);

    jour.innerText = dayName;
    //! JOUR DE LA SEMAINE

    //! GIF DU JOUR + Commentaire du jour
    //? R√©cup√©rer le result du promise (urlGif)
    let urlGif = makeNewGif(dayName);
    urlGif.then((result) => {
        let gif = document.getElementById("gif");
        gif.src = result;
    });
    //! GIF DU JOUR + Commentaire du jour

    //! On refait la fonction toutes les 10 minutes pour changer le gif
    setInterval(function () {
        //? R√©cup√©rer le result du promise (urlGif)
        let urlGif = makeNewGif(dayName);
        urlGif.then((result) => {
            let gif = document.getElementById("gif");
            gif.src = result;
        });
    }, 600000);
}

function getDay(val) {
    var dayName = "";
    switch (val) {
        case 0:
            dayName = "Un Dimanche ?";
            break;
        case 1:
            dayName = "Un Lundi ?";
            break;
        case 2:
            dayName = "Un Mardi ?";
            break;
        case 3:
            dayName = "Un Mercredi ?";
            break;
        case 4:
            dayName = "Un Jeudi ?";
            break;
        case 5:
            dayName = "Un Vendredi ?";
            break;
        case 6:
            dayName = "Un Samedi ?";
            break;
        default:
            dayName = "error, day not found";
            break;
    }

    return dayName;
}

function makeNewGif(dayName) {

    let randomPrompt = randomSearchPrompt(dayName);

    // TODO: appel fonction pour les gif par rapport au textprompt 
    //? Requetes API pour les gifs (lien suivant : https://tenor.googleapis.com/v2/search?q=excited&key=AIzaSyCcmLXLnEEGPF67vQWlfnubnWA0C6WlNRs&client_key=my_test_app&limit=8)
    //? On aura des variables en fonction des parametre du lien.
    //* q = le textprompt
    //* key = la cl√© de l'API
    //* client_key = la cl√© de l'application
    //! On return seulement un lien al√©atoire parmis les 8 liens de l'API

    let link = randomGif(randomPrompt)
    return link;
}

function randomSearchPrompt(dayName) {
    let randomPrompt = [];
    switch (dayName) {
        case 'Un Lundi ?':
            randomPrompt = [
                'cestparti',
                'decollage',
                'deploiement',
                'happydeveloppeur',
                'tired'
            ]
            break;

        case 'Un Mardi ?':
            randomPrompt = [
                'continuation',
                'efficacite',
                'productivite',
                'bonchance',
                'investi'
            ]
            break;

        case 'Un Mercredi ?':
            randomPrompt = [
                'stabilite',
                'recherche',
                'becareful',
                'reussite',
                'avancement'
            ]
            break;

        case 'Un Jeudi ?':
            randomPrompt = [
                'evaluation',
                'chokbar',
                'relax',
                'preparation',
                'reflechir'
            ]
            break;

        case 'Un Vendredi ?':
            randomPrompt = [
                'mauvaischoix',
                'OhNoo',
                'apero',
                'jamais',
                'arrete'
            ]
            break;

        case 'Un Samedi ?':
            randomPrompt = [
                'fada',
                'weekend',
                'mimir',
                'gaming',
                'sardine'
            ]
            break;

        case 'Un Dimanche ?':
            randomPrompt = [
                'zzzzzzzzzz',
                'apero',
                'raclette',
                'ptitdej',
                'tk78'
            ]
            break;

        default:
            randomPrompt = ['ERREUR'];
    }

    let jourFerie = jourFerieTomorrow();
    jourFerie.then((result) => {
        jourFerie = result;
        if (jourFerie) {
            randomPrompt = [
                'Feri√©',
                'NotWorking',
                'STOP',
                'arrete',
            ];
        }
    });

    let randomTextPrompt = randomPrompt[Math.floor(Math.random() * randomPrompt.length)]

    getCommentRandom(dayName, randomTextPrompt)

    return randomTextPrompt;
}

function randomGif(prompt) {
    return new Promise((resolve, reject) => {
        let API_KEY = "AIzaSyCcmLXLnEEGPF67vQWlfnubnWA0C6WlNRs";
        let CLIENT_KEY = "my_test_app";
        let limit = 15;
        let url = "https://tenor.googleapis.com/v2/search?q=" + prompt + "&key=" + API_KEY + "&client_key=" + CLIENT_KEY + "&limit=" + limit;

        let request = new XMLHttpRequest();

        request.open('GET', url, true);

        request.onload = function () {
            if (request.status >= 200 && request.status < 400) {
                let data = JSON.parse(this.response);
                let randomLink = data.results[Math.floor(Math.random() * data.results.length)].media_formats.gif.url;
                resolve(randomLink); // Renvoyer le r√©sultat via la promesse
            } else {
                reject('Error');
            }
        };

        request.send();
    });
}

function getCommentRandom(dayName, textPrompt) {
    let commentText = "BLABLA";
    if (textPrompt == 'ERREUR') commentText = "Erreur, le site marche plus √† l'aide !";

    let jourFerie = jourFerieTomorrow();
    jourFerie.then((result) => {
        jourFerie = result;

        if (jourFerie) {
            ferieComment = [
                "HOP HOP HOP ! Demain c'est f√©ri√©, donc ne touches √† rien, retourne √† ta place et dev SEULEMENT en local !",
                "La veille d'un jour f√©ri√©, prenons une pause. Le travail peut attendre, profitons de ce moment pour nous ressourcer !",
                "Demain, c'est jour f√©ri√©. La veille est un moment pour pr√©parer une transition en douceur. √âvitons les changements majeurs aujourd'hui !",
                "Vas-y mets en prod, on va rien dire... SAUF SI TU VEUX TE FAIRE VIRER !",
            ]

            commentText = ferieComment[Math.floor(Math.random() * ferieComment.length)]
        } else {
            if (dayName == 'Un Lundi ?') {
                //!Lundi
                if (textPrompt == 'cestparti') commentText = "Lundi matin, c'est parti pour une semaine pleine de d√©fis et d'opportunit√©s !";
                if (textPrompt == 'decollage') commentText = "Lundi, pr√™t pour le d√©collage vers de nouvelles r√©alisations !";
                if (textPrompt == 'deploiement') commentText = "Lundi, un jour id√©al pour le d√©ploiement de nos projets. C'est parti !";
                if (textPrompt == 'happydeveloppeur') commentText = "Lundi, soyons des d√©veloppeurs heureux en faisant ce que nous aimons !";
                if (textPrompt == 'tired') commentText = "Lundi matin, un peu fatigu√© ? Prends ton caf√© et rejoins-nous faire des mises en production bien pr√©par√©e !";
            } else if (dayName == 'Un Mardi ?') {
                //!Mardi
                if (textPrompt == 'continuation') commentText = "Mardi, poursuivons avec d√©termination ce que nous avons commenc√©. La cl√© du succ√®s est la continuit√© !";
                if (textPrompt == 'efficacite') commentText = "Mardi, l'efficacit√© est notre alli√©e. Mettons-nous au travail de mani√®re optimale !";
                if (textPrompt == 'productivite') commentText = "Mardi, maximisons notre productivit√© et balan√ßons tout en prod sans trop tarder.";
                if (textPrompt == 'bonchance') commentText = "Mardi, la chance nous sourit. Continuons √† travailler dur, car ce n'est que le d√©but de la semaine !";
                if (textPrompt == 'investi') commentText = "Mardi, investissons du temps pour ce qui est des mises en prod et les tests. On aura le temps de coder fin de semaine üôÉ";
            } else if (dayName == 'Un Mercredi ?') {
                //!Mercredi
                if (textPrompt == 'stabilite') commentText = "Mercredi, la stabilit√© est essentielle. Assurons-nous de maintenir une base solide pour nos projets.";
                if (textPrompt == 'recherche') commentText = "Mercredi, un jour propice √† la recherche et √† l'innovation. Exp√©rimentons de nouvelles choses !";
                if (textPrompt == 'becareful') commentText = "Mercredi, soyons prudents dans nos d√©cisions. La vigilance est la cl√© de la r√©ussite !";
                if (textPrompt == 'reussite') commentText = "Mercredi, avan√ßons avec confiance vers la r√©ussite. Nous sommes sur la bonne voie !";
                if (textPrompt == 'avancement') commentText = "Mercredi, continuons √† progresser et √† avancer. Chaque pas compte vers nos objectifs !";
            } else if (dayName == 'Un Jeudi ?') {
                //!Jeudi
                if (textPrompt == 'evaluation') commentText = "Jeudi, prenons un moment pour √©valuer notre progression. C'est le chemin vers l'excellence !";
                if (textPrompt == 'chokbar') commentText = "TU VEUX METTRE EN PROD UN JEUDI ! T'es chokbar !";
                if (textPrompt == 'relax') commentText = "Jeudi, d√©tendons-nous et profitons d'un moment de relaxation bien m√©rit√©. Le repos est important ! Donc pas de mise en prod !";
                if (textPrompt == 'preparation') commentText = "Jeudi, pr√©parons-nous mentalement pour les d√©fis √† venir. Reste tranquille, et Lundi prochain tu pourras mettre en prod !";
                if (textPrompt == 'reflechir') commentText = "R√©fl√©chis a ce que tu fais avant de faire quoi que ce soit ! On est jeudi, √† tes risques et p√©ril !";
            } else if (dayName == 'Un Vendredi ?') {
                //!Vendredi
                if (textPrompt == 'mauvaischoix') commentText = "Vendredi, faisons le bon choix en √©vitant les mises en production. Pr√©parons-nous pour un week-end paisible !";
                if (textPrompt == 'OhNoo') commentText = "Oh noooo ! Pourquoi vouloir mettre en prod un vendredi ?! Si je vois une merge request, je me casse !";
                if (textPrompt == 'apero') commentText = "Vendredi, fin de semaine ! Enfin, nous pouvons nous d√©tendre et profiter d'un ap√©ro bien m√©rit√©. Qui est partant ce soir ?";
                if (textPrompt == 'jamais') commentText = "Vendredi, le jour o√π les mises en production ne sont jamais une bonne id√©e. √âvitons les soucis le week-end !";
                if (textPrompt == 'arrete') commentText = "Vendredi, arr√™tons les mises en production. C'est le moment de se pr√©parer pour un week-end sans encombre !";
            } else if (dayName == 'Un Samedi ?') {
                //!Samedi
                if (textPrompt == 'fada') commentText = "T'y es compl√©tement fada toi ! C'est le week-end et tu veux mettre en prod ?! NON !";
                if (textPrompt == 'weekend') commentText = "Tranquille, reste pos√© dans ton canap√©... D'ailleurs qu'est ce que tu fais sur ce site un samedi ?!";
                if (textPrompt == 'mimir') commentText = "Rompiche ! C'est le week-end, tu peux faire la grasse matin√©e !";
                if (textPrompt == 'gaming') commentText = "Un peu de d√©tente en jouant aux jeux... Profite au lieu d'√™tre ici !";
                if (textPrompt == 'sardine') commentText = "A qu'est ce qu'on est serr√© au fond de cette boite... Profite du week-end pour te d√©tendre !";
            } else if (dayName == 'Un Dimanche ?') {
                //!Dimanche
                if (textPrompt == 'zzzzzzzzzz') commentText = "ZZZzzzzZZzZZZZZZZzzzzZZzzzZZzzZZzZZZzZZzZzZzZzZzZZZzZZZzZZzz, VAS DORMIR !";
                if (textPrompt == 'apero') commentText = "Allez, prends un dernier verre et pr√©pare toi pour la semaine qui arrives !";
                if (textPrompt == 'raclette') commentText = "Dimanche, pos√©, tranquille, en famille, avec une bonne raclette !";
                if (textPrompt == 'ptitdej') commentText = "D√©j√† debout ?! Profite du week-end pour faire la grasse matin√©e !";
                if (textPrompt == 'tk78') commentText = "Aujourd'hui, si je fais cette vid√©o-l√†, c'est tout simplement pour insulter des grosses m√®res. Aujourd'hui j'lai jur√©, j'ai dit la t√™te de oim. √áa va pas se passer comme √ßa, aujourd'hui jvais insulter des m√®res.";
            }

        }
        //! COMMENTAIRE DU JOUR
        // R√©cuperer le commentaire du jour
        let comment = document.getElementById("comment");
        // Changer le commentaire en fonction du jour et du nombre al√©atoire
        comment.innerText = commentText;
        //! COMMENTAIRE DU JOUR
    });
}

function jourFerieTomorrow() {
    return new Promise((resolve, reject) => {
        let year = new Date().getFullYear();
        let url = 'https://calendrier.api.gouv.fr/jours-feries/metropole/' + year + '.json'

        let request = new XMLHttpRequest();

        request.open('GET', url, true);
        let isFerie = false;

        request.onload = function () {
            if (request.status >= 200 && request.status < 400) {
                let data = JSON.parse(this.response);

                let tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                let tomorrowString = tomorrow.toISOString().slice(0, 10);

                for (const [key, value] of Object.entries(data)) {
                    // console.log(key, tomorrowString, key == tomorrowString);
                    if (key == tomorrowString) {
                        isFerie = true;
                    }
                }
                resolve(isFerie);
            } else {
                reject(false);
            }
        };

        request.send();
    });
}

let meteoShow = false;
function showMeteo() {
    let meteo = document.getElementById("meteo");
    if (meteoShow) {
        meteo.classList.remove("meteo-transition");
        meteoShow = false;
    } else {
        meteo.classList.add("meteo-transition");
        meteoShow = true;
    }
}